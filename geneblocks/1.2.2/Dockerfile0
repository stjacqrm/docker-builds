# base image
FROM ubuntu:bionic

# metadata
LABEL base.image="ubuntu:bionic"
LABEL version="1"
LABEL software="Geneblocks"
LABEL software.version="1.2.2"
LABEL description="GeneBlocks is a Python library for comparing DNA sequences and NC_045512.2 gb file."
LABEL website="https://github.com/Edinburgh-Genome-Foundry/Geneblocks/tree/v1.2.2"
LABEL license="https://github.com/Edinburgh-Genome-Foundry/Geneblocks/blob/master/LICENCE.txt"
LABEL maintainer="Rachael St. Jacques"
LABEL maintainer.email="rachael.stjacques@dgs.virginia.gov"

RUN apt-get update && apt-get -y --no-install-recommends install \
    unzip \
    tar \
    python3.5 \
    ncbi-blast+ \
    python3-pip \
    #python-setuptools \
    python-dev \
    gzip \
    wget && \
    apt-get clean

#grab genbank file
RUN wget https://github.com/stjacqrm/gb_files/archive/9f32c86c209aab5a5157503d607ee7ed66f81ad3.zip &&\
    unzip 9f32c86c209aab5a5157503d607ee7ed66f81ad3.zip &&\
    mv gb_files-9f32c86c209aab5a5157503d607ee7ed66f81ad3 gb_files &&\
    mkdir /reference &&\
    cp /gb_files/NC_045512_2.gb /reference

RUN wget https://github.com/chapmanb/bcbb/archive/3ba0ec42120065cca136fd496948948f57081039.zip &&\
    unzip 3ba0ec42120065cca136fd496948948f57081039.zip &&\
    mv bcbb-3ba0ec42120065cca136fd496948948f57081039 BCBio &&\
    chmod 777 -R BCBio

RUN pip3 install wheel==0.35.1 biopython==1.77 setuptools==50.0.0 matplotlib==3.3.2

RUN pip3 install bcbio-gff==0.6.6

#RUN ln -s /usr/bin/python3 /usr/bin/python

#install the software
RUN wget https://github.com/Edinburgh-Genome-Foundry/Geneblocks/archive/v1.2.2.zip &&\
    unzip v1.2.2.zip &&\
    cd Geneblocks-1.2.2 &&\
    mkdir /data

#set paths
ENV PATH="/Geneblocks-1.2.2:\
/BCBio:\
/BCBio/gff/Scripts/gff:\
/reference:\
$PATH"\
    LC_ALL=C

WORKDIR /data
